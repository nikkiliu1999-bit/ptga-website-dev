import{_ as V,u as R,r as c,p as M,q as P,x as j,y as H,c as o,g as p,a as s,b as Y,t as a,h as v,F as w,d as x,n as I,i as $,j as G,k as J,s as _,l as K,o as n}from"./index-BluKeNpR.js";const Q={class:"user-account-container"},W={key:0,class:"text-center py-20"},X={key:1},Z={class:"account-card"},ss={class:"account-header"},ts={class:"avatar"},es={class:"account-info"},as={class:"account-meta"},ls={id:"orders",class:"orders-section"},os={key:0,class:"no-data"},ns={key:1,class:"table-container"},is=["onClick"],ds={id:"feedbacks",class:"feedbacks-section"},rs={key:0,class:"text-center py-10"},us={key:1,class:"no-data"},cs={key:2,class:"feedback-list"},vs={class:"feedback-header"},fs={class:"feedback-date"},ps={class:"feedback-type"},_s={class:"feedback-id"},ms={class:"feedback-content"},bs={class:"feedback-meta"},gs={key:0,class:"modal-overlay"},hs={class:"modal"},ys={class:"modal-header"},ks={class:"modal-title"},ws={class:"modal-body"},xs={class:"grid-cols-2"},Cs={class:"info-group"},Ds={class:"info-value"},Ts={class:"info-group"},qs={class:"info-value"},Is={class:"info-group"},Ls={class:"info-value"},Ss={class:"info-group"},Bs={class:"info-value"},Es={class:"info-group"},Fs={class:"info-value"},Ns={class:"info-group"},Os={class:"info-value"},zs={class:"info-group"},As={class:"info-value"},Us={class:"item-title"},Vs={class:"item-details"},Rs={class:"detail-value"},Ms={class:"detail-value"},Ps={class:"detail-value"},js={class:"detail-value"},Hs={class:"detail-value"},Ys={class:"mt-3"},$s={class:"detail-value"},Gs={key:2,class:"login-prompt"},Js={__name:"UserAccount",setup(Ks){const C=K(),m=H(),{user:d,logout:L,loading:b}=R(),g=c([]),h=c([]),i=c(null),y=c([]),k=c(!1),S=M(()=>{if(!d.value?.email)return"U";const[e]=d.value.email.split("@");return e[0].toUpperCase()}),B=async()=>{await L(),C.push({name:"Home"})},f=e=>e?new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",D=e=>{if(!e)return"";const t=e.toLowerCase();return t.includes("pending")?"status-pending":t.includes("processing")?"status-processing":t.includes("completed")?"status-completed":t.includes("shipped")?"status-shipped":t.includes("cancelled")?"status-cancelled":""},E=e=>{if(!e)return"";switch(e){case"small":return"小号盒子";case"medium":return"中号盒子";case"custom":return"定制盒子";default:return e}},F=e=>e?Math.round(e*.01):0,N=e=>e?{question:"问题咨询",suggestion:"功能建议",complaint:"投诉",order:"订单相关",other:"其他"}[e]||e:"",O=()=>{C.push({name:"CustomerService"})},z=async e=>{try{const{data:t,error:u}=await _.from("submissions").select("*").eq("id",e).single();if(u)throw u;i.value=t;const{data:l,error:r}=await _.from("submission_items").select("*").eq("submission_id",t.tracking_id);if(r)throw r;y.value=l}catch(t){console.error("获取订单详情失败:",t),alert("无法加载订单详情，请稍后再试")}},T=()=>{i.value=null,y.value=[]},A=async()=>{if(d.value){k.value=!0;try{console.log("当前用户ID:",d.value.id);const{data:e,error:t}=await _.from("feedbacks").select("*").eq("user_id",d.value.id).order("submitted_at",{ascending:!1});if(t)throw console.error("Supabase反馈查询错误:",t),t;console.log("获取到的反馈数据:",e),h.value=e||[]}catch(e){console.error("反馈加载错误:",e),alert("反馈加载失败: "+e.message)}finally{k.value=!1}}},U=async()=>{if(d.value)try{const{data:e,error:t}=await _.from("submissions").select("*").eq("user_id",d.value.id).order("created_at",{ascending:!1});if(t)throw t;g.value=e||[]}catch(e){console.error("订单加载错误:",e),alert("订单加载失败，请刷新页面重试")}},q=e=>{e&&setTimeout(()=>{const t=document.querySelector(e);if(t){const l=t.getBoundingClientRect().top+window.pageYOffset;window.scrollTo({top:l-100,behavior:"smooth"})}},100)};return P(()=>m.hash,e=>{q(e)}),j(async()=>{if(d.value){b.value=!0;try{await Promise.all([U(),A()]),m.hash&&q(m.hash)}catch(e){console.error("初始化错误:",e)}finally{b.value=!1}}}),(e,t)=>{const u=J("router-link");return n(),o("div",Q,[p(b)?(n(),o("div",W,t[0]||(t[0]=[s("div",{class:"spinner"},[s("i",{class:"fas fa-spinner fa-spin fa-3x",style:{color:"#4776E6"}}),s("p",{class:"mt-4 text-lg"},"加载中，请稍候...")],-1)]))):p(d)?(n(),o("div",X,[s("div",Z,[s("div",ss,[s("div",ts,a(S.value),1),s("div",es,[s("h1",null,a(p(d).email),1),s("p",as,"注册于: "+a(f(p(d).created_at)),1)])]),s("button",{onClick:B,class:"logout-btn"},t[1]||(t[1]=[s("i",{class:"fas fa-sign-out-alt"},null,-1),v(" 退出登录 ",-1)]))]),s("div",ls,[t[4]||(t[4]=s("div",{class:"section-header"},[s("h3",{class:"section-title"},[s("i",{class:"fas fa-shopping-bag"}),v(" 我的订单记录 ")])],-1)),g.value.length===0?(n(),o("div",os,t[2]||(t[2]=[s("i",{class:"fas fa-box-open"},null,-1),s("p",null,"暂无订单记录",-1)]))):(n(),o("div",ns,[s("table",null,[t[3]||(t[3]=s("thead",null,[s("tr",null,[s("th",null,"订单号"),s("th",null,"提交日期"),s("th",null,"商品数量"),s("th",null,"总金额"),s("th",null,"状态"),s("th",null,"操作")])],-1)),s("tbody",null,[(n(!0),o(w,null,x(g.value,l=>(n(),o("tr",{key:l.id},[s("td",null,a(l.tracking_id),1),s("td",null,a(f(l.created_at)),1),s("td",null,a(l.items_count),1),s("td",null,"¥"+a(l.total_price),1),s("td",null,[s("span",{class:I(["status-badge",D(l.status)])},a(l.status),3)]),s("td",null,[s("button",{onClick:r=>z(l.id),class:"action-btn"}," 查看详情 ",8,is)])]))),128))])])]))]),s("div",ds,[s("div",{class:"section-header"},[t[6]||(t[6]=s("h3",{class:"section-title"},[s("i",{class:"fas fa-comments"}),v(" 我的反馈 ")],-1)),s("button",{onClick:O,class:"new-feedback-btn"},t[5]||(t[5]=[s("i",{class:"fas fa-plus"},null,-1),v(" 提交新反馈 ",-1)]))]),k.value?(n(),o("div",rs,t[7]||(t[7]=[s("i",{class:"fas fa-spinner fa-spin fa-2x",style:{color:"#4776E6"}},null,-1),s("p",{class:"mt-2"},"加载反馈中...",-1)]))):h.value.length===0?(n(),o("div",us,t[8]||(t[8]=[s("i",{class:"fas fa-comment-slash"},null,-1),s("p",null,"暂无反馈记录",-1)]))):(n(),o("div",cs,[(n(!0),o(w,null,x(h.value,l=>(n(),o("div",{key:l.id,class:"feedback-card"},[s("div",vs,[s("div",null,[s("span",fs,a(f(l.submitted_at)),1),s("span",ps,a(N(l.feedbackType)),1)]),s("span",_s,"反馈ID: "+a(l.id?String(l.id).substring(0,8):""),1)]),s("p",ms,a(l.message),1),s("div",bs,[s("span",null,"提交人: "+a(l.name||"匿名"),1),s("span",null,"邮箱: "+a(l.email),1)])]))),128))]))]),i.value?(n(),o("div",gs,[s("div",hs,[s("div",ys,[s("h3",ks,"订单详情 #"+a(i.value.tracking_id),1),s("button",{onClick:T,class:"close-btn"},t[9]||(t[9]=[s("i",{class:"fas fa-times"},null,-1)]))]),s("div",ws,[s("div",xs,[s("div",null,[s("div",Cs,[t[10]||(t[10]=s("div",{class:"info-label"},"订单号",-1)),s("div",Ds,a(i.value.tracking_id),1)]),s("div",Ts,[t[11]||(t[11]=s("div",{class:"info-label"},"提交日期",-1)),s("div",qs,a(f(i.value.created_at)),1)]),s("div",Is,[t[12]||(t[12]=s("div",{class:"info-label"},"状态",-1)),s("div",Ls,[s("span",{class:I(["status-badge",D(i.value.status)])},a(i.value.status),3)])]),s("div",Ss,[t[13]||(t[13]=s("div",{class:"info-label"},"总金额",-1)),s("div",Bs,"¥"+a(i.value.total_price),1)]),t[17]||(t[17]=s("div",{class:"info-group"},[s("h4",{class:"info-label",style:{"font-size":"18px","margin-top":"25px"}},"收件信息")],-1)),s("div",Es,[t[14]||(t[14]=s("div",{class:"info-label"},"收件人",-1)),s("div",Fs,a(i.value.customer_name),1)]),s("div",Ns,[t[15]||(t[15]=s("div",{class:"info-label"},"电话",-1)),s("div",Os,a(i.value.phone),1)]),s("div",zs,[t[16]||(t[16]=s("div",{class:"info-label"},"地址",-1)),s("div",As,a(i.value.address),1)])]),s("div",null,[t[24]||(t[24]=s("h4",{class:"info-label",style:{"font-size":"18px","margin-bottom":"15px"}},"商品列表",-1)),(n(!0),o(w,null,x(y.value,(l,r)=>(n(),o("div",{key:r,class:"item-card"},[s("div",Us,"商品 #"+a(r+1)+": "+a(l.character_name),1),s("div",Vs,[s("div",null,[t[18]||(t[18]=s("span",{class:"detail-label"},"品牌:",-1)),s("span",Rs,a(l.brand),1)]),s("div",null,[t[19]||(t[19]=s("span",{class:"detail-label"},"服务类型:",-1)),s("span",Ms,a(l.service_type==="standard"?"标准版":"旗舰版"),1)]),s("div",null,[t[20]||(t[20]=s("span",{class:"detail-label"},"包装盒:",-1)),s("span",Ps,a(E(l.box_type)),1)]),s("div",null,[t[21]||(t[21]=s("span",{class:"detail-label"},"保价:",-1)),s("span",js,"¥"+a(l.insurance_value)+" (¥"+a(F(l.insurance_value))+"保费)",1)]),s("div",null,[t[22]||(t[22]=s("span",{class:"detail-label"},"价格:",-1)),s("span",Hs,"¥"+a(l.item_price),1)])]),s("div",Ys,[t[23]||(t[23]=s("div",{class:"detail-label"},"备注:",-1)),s("p",$s,a(l.notes||"无备注"),1)])]))),128))])])]),s("div",{class:"modal-footer"},[s("button",{onClick:T,class:"btn btn-secondary"}," 关闭 ")])])])):Y("",!0)])):(n(),o("div",Gs,[t[26]||(t[26]=s("h2",null,"您尚未登录",-1)),t[27]||(t[27]=s("p",null,"请登录以访问您的账户信息",-1)),$(u,{to:{name:"Login"},class:"login-btn"},{default:G(()=>t[25]||(t[25]=[v(" 立即登录 ",-1)])),_:1,__:[25]})]))])}}},Ws=V(Js,[["__scopeId","data-v-3ae6ffed"]]);export{Ws as default};
