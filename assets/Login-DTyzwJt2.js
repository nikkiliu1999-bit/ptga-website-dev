import{_ as D,u as E,r as a,c as i,a as e,b as d,F as N,d as T,w as C,e as b,v as _,f as B,g as M,h as c,i as R,j as z,k as j,t as V,n as F,s as A,l as I,o as n,m as G}from"./index-gNWYYRN8.js";const H={class:"login-page"},J={class:"bubbles"},K={class:"login-card"},O={class:"card-body"},Q={class:"input-group"},W={class:"input-group"},X={class:"options"},Y={class:"remember-me"},Z=["disabled"],ss={key:0},es={key:1,class:"loading"},ls={class:"social-login"},os={class:"register-link"},ts={key:0,class:"error-message"},as={class:"modal-body"},is={class:"input-group"},ns={class:"modal-footer"},rs=["disabled"],ds=["disabled"],us={key:0},ps={key:1,class:"loading"},vs={__name:"Login",setup(cs){const P=I(),{login:L,loading:y}=E(),m=a(""),w=a(""),h=a(!1),u=a(""),k=a(!1),p=a(""),v=a(!1),r=a(""),f=a(!1),S=()=>{k.value=!0,p.value=m.value,r.value=""},g=()=>{k.value=!1},$=async()=>{if(!p.value){r.value="请输入邮箱地址",f.value=!1;return}v.value=!0,r.value="";try{const s=`${window.location.origin}/reset-password`;console.log("生成重置链接，重定向地址:",s);const{error:t}=await A.auth.resetPasswordForEmail(p.value,{redirectTo:s,type:"recovery"});if(t)throw console.error("Supabase生成链接错误:",t),t;f.value=!0,r.value="重置密码的链接已发送到您的邮箱，请查收（注意检查垃圾邮件）",p.value="",setTimeout(g,3e3)}catch(l){f.value=!1,r.value=l.message||"发送重置链接失败，请稍后再试",console.error("忘记密码错误:",l)}finally{v.value=!1}},U=l=>{const t=[{width:"40px",height:"40px",left:"10%",duration:"8s",delay:"0s"},{width:"20px",height:"20px",left:"20%",duration:"5s",delay:"1s"},{width:"50px",height:"50px",left:"35%",duration:"7s",delay:"2s"},{width:"80px",height:"80px",left:"50%",duration:"11s",delay:"0s"},{width:"35px",height:"35px",left:"55%",duration:"6s",delay:"1s"},{width:"45px",height:"45px",left:"65%",duration:"8s",delay:"3s"},{width:"90px",height:"90px",left:"70%",duration:"12s",delay:"2s"},{width:"25px",height:"25px",left:"80%",duration:"6s",delay:"2s"},{width:"15px",height:"15px",left:"70%",duration:"5s",delay:"1s"},{width:"90px",height:"90px",left:"25%",duration:"10s",delay:"4s"}][l-1];return{width:t.width,height:t.height,left:t.left,animationDuration:t.duration,animationDelay:t.delay}},q=async()=>{u.value="";try{await L(m.value,w.value,h.value);const l=P.currentRoute.value.query.redirect||"/account";P.push(l)}catch(l){u.value=l.message||"登录失败，请检查邮箱和密码",console.error("登录失败:",l)}},x=async l=>{u.value="";try{throw new Error(`暂不支持 ${l} 登录`)}catch(s){u.value=s.message,console.error(`${l} 登录失败:`,s)}};return(l,s)=>{const t=j("router-link");return n(),i("div",H,[e("div",J,[(n(),i(N,null,T(10,o=>e("div",{key:o,class:"bubble",style:G(U(o))},null,4)),64))]),e("div",K,[s[19]||(s[19]=e("div",{class:"card-header"},[e("div",{class:"logo"},[e("i",{class:"fas fa-lock"})]),e("h2",null,"欢迎回来"),e("p",null,"请登录您的账户以继续")],-1)),e("div",O,[e("form",{onSubmit:C(q,["prevent"])},[e("div",Q,[s[8]||(s[8]=e("i",{class:"fas fa-envelope"},null,-1)),b(e("input",{id:"email-address","onUpdate:modelValue":s[0]||(s[0]=o=>m.value=o),name:"email",type:"email",autocomplete:"email",required:"",placeholder:"邮箱地址"},null,512),[[_,m.value]])]),e("div",W,[s[9]||(s[9]=e("i",{class:"fas fa-lock"},null,-1)),b(e("input",{id:"password","onUpdate:modelValue":s[1]||(s[1]=o=>w.value=o),name:"password",type:"password",autocomplete:"current-password",required:"",placeholder:"密码"},null,512),[[_,w.value]])]),e("div",X,[e("div",Y,[b(e("input",{id:"remember-me","onUpdate:modelValue":s[2]||(s[2]=o=>h.value=o),name:"remember-me",type:"checkbox"},null,512),[[B,h.value]]),s[10]||(s[10]=e("label",{for:"remember-me"},"记住我",-1))]),e("a",{href:"#",class:"forgot-password",onClick:C(S,["prevent"])},"忘记密码?")]),e("button",{type:"submit",disabled:M(y),class:"login-btn"},[M(y)?d("",!0):(n(),i("span",ss,"登录")),M(y)?(n(),i("span",es,s[11]||(s[11]=[e("span",{class:"spinner"},null,-1),c(" 登录中... ",-1)]))):d("",!0)],8,Z),s[17]||(s[17]=e("div",{class:"divider"},[e("span",null,"或使用其他方式登录")],-1)),e("div",ls,[e("div",{class:"social-btn google",onClick:s[3]||(s[3]=o=>x("google"))},s[12]||(s[12]=[e("i",{class:"fab fa-google"},null,-1)])),e("div",{class:"social-btn facebook",onClick:s[4]||(s[4]=o=>x("facebook"))},s[13]||(s[13]=[e("i",{class:"fab fa-facebook-f"},null,-1)])),e("div",{class:"social-btn twitter",onClick:s[5]||(s[5]=o=>x("twitter"))},s[14]||(s[14]=[e("i",{class:"fab fa-twitter"},null,-1)]))]),e("div",os,[s[16]||(s[16]=c(" 还没有账号? ",-1)),R(t,{to:{name:"Register"}},{default:z(()=>s[15]||(s[15]=[c("立即注册",-1)])),_:1,__:[15]})])],32),u.value?(n(),i("div",ts,[s[18]||(s[18]=e("i",{class:"fas fa-exclamation-circle"},null,-1)),c(" "+V(u.value),1)])):d("",!0)])]),k.value?(n(),i("div",{key:0,class:"modal-backdrop",onClick:g},[e("div",{class:"modal",onClick:s[7]||(s[7]=C(()=>{},["stop"]))},[e("div",{class:"modal-header"},[s[21]||(s[21]=e("h3",null,"重置密码",-1)),e("button",{class:"close-btn",onClick:g},s[20]||(s[20]=[e("i",{class:"fas fa-times"},null,-1)]))]),e("div",as,[s[23]||(s[23]=e("p",null,"请输入您的邮箱地址，我们将发送重置密码的链接给您",-1)),e("div",is,[s[22]||(s[22]=e("i",{class:"fas fa-envelope"},null,-1)),b(e("input",{"onUpdate:modelValue":s[6]||(s[6]=o=>p.value=o),type:"email",required:"",placeholder:"邮箱地址"},null,512),[[_,p.value]])]),r.value?(n(),i("div",{key:0,class:F(f.value?"success-message":"error-message")},[e("i",{class:F(f.value?"fas fa-check-circle":"fas fa-exclamation-circle")},null,2),c(" "+V(r.value),1)],2)):d("",!0)]),e("div",ns,[e("button",{class:"cancel-btn",onClick:g,disabled:v.value}," 取消 ",8,rs),e("button",{class:"submit-btn",onClick:$,disabled:v.value},[v.value?d("",!0):(n(),i("span",us,"发送重置链接")),v.value?(n(),i("span",ps,s[24]||(s[24]=[e("span",{class:"spinner"},null,-1),c(" 发送中... ",-1)]))):d("",!0)],8,ds)])])])):d("",!0)])}}},ms=D(vs,[["__scopeId","data-v-e699b987"]]);export{ms as default};
